var __spreadArrays=this&&this.__spreadArrays||function(){for(var n=0,r=0,t=arguments.length;r<t;r++)n+=arguments[r].length;var e=Array(n),i=0;for(r=0;r<t;r++)for(var s=arguments[r],o=0,a=s.length;o<a;o++,i++)e[i]=s[o];return e};function __isPromise(n){return n instanceof Promise||n instanceof ArgsPromise}function __handle(n){var r=void 0===n?[]:n instanceof Array?n:[n];return 1===r.length&&__isPromise(r[0])?new Promise((function(n,t){r[0].then((function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];n(r)}),(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t(n)}))})):r}var APOpts=function(n,r){void 0===n&&(n=new Promise((function(){}))),void 0===r&&(r=[]),this.residents=r,this.promise=n},ArgsPromise=function(){function n(n){var r=this;if(this[Symbol.toStringTag]="ArgsPromise",n instanceof APOpts)this._residents=n.residents,this._promise=n.promise;else{if(!(n instanceof Function))throw new Error("The constructor of ArgsPromise expects an executor function as argument.");this._residents=[],this._promise=new Promise((function(t,e){n((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t(__handle(n))}),(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];e(n)}),(function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];r._residents=n}))}))}}return n.prototype.then=function(r,t){var e=this,i=r?function(n){return __handle(r.apply(void 0,__spreadArrays(n,e._residents)))}:void 0,s=t?function(n){return __handle(t.apply(void 0,__spreadArrays(n,e._residents)))}:void 0;return new n(new APOpts(this._promise.then(i,s),this._residents))},n.prototype.catch=function(r){var t=this,e=r?function(n){return __handle(r.apply(void 0,__spreadArrays(n,t._residents)))}:void 0;return new n(new APOpts(this._promise.catch(e),this._residents))},n.prototype.finally=function(r){var t=this,e=r?function(){return __handle(r.apply(void 0,t._residents))}:void 0;return new n(new APOpts(this._promise.finally(e),this._residents))},n.prototype.pack=function(){var r=this;return new n((function(n){r._promise.then((function(t){n(__spreadArrays(t,r._residents))}))}))},n.prototype.to=function(){var r=this;return new n((function(n){r._promise.then((function(t){n([null,__spreadArrays(t,r._residents)])})).catch((function(t){n([__spreadArrays(t,r._residents),void 0])}))}))},n}();